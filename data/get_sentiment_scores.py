#!/usr/bin/python
"""
Reads the review database for the sentiment
associated with various keywords.
"""

import sqlite3
from nltk.sentiment.vader import SentimentIntensityAnalyzer
from nltk import tokenize
import numpy
import csv


# find sentiment scores for a topic keyword
def get_sentiment_by_keyword(body, keyword):
    sentences = tokenize.sent_tokenize(body)
    sid = SentimentIntensityAnalyzer()
    scores = []
    for sentence in sentences:
        if keyword in sentence:
            ss = sid.polarity_scores(sentence)
            scores.append(ss['compound'])
    if len(scores) == 0:
        print "no matches"
        mean = 0
    else:
        mean = numpy.mean(scores)
    return mean

if __name__ == '__main__':
    infile = "goodreadsreviews.sqlite"

    conn = sqlite3.connect(infile)
    conn.row_factory = sqlite3.Row
    cur = conn.cursor()
    cur.execute('select book_id, body, rating from Reviews')
    database = cur.fetchall()
    # database is a list of sqlite3 rows where [0] is book_id, [1] is body, [2] is rating

    shelf_cur = conn.cursor()
    shelf_cur.execute('select shelf, people, book_id from Shelves')
    shelves = shelf_cur.fetchall()
    shelf_dicts = []
    curr_book_id = 0
    for row in shelves:
        tempdict = {}
        for shelf in shelves:
            if shelf[2] == curr_book_id:
                if 'book_id' not in tempdict:
                    tempdict['book_id'] = curr_book_id
                tempdict[shelf[0]] = int(shelf[1])
        if not tempdict:
            break
        else:
            shelf_dicts.append(tempdict)
            curr_book_id += 1
    # remove irrelevant shelf names from dicts
    relevant_shelves = [u'folklore', u'family secrets', u'french literature', u'animal books', u'olympians', u'asian', u'controversial', u'a novel in short stories', u'evermore', u'first in series', u'non fiction', u'relationships', u'womens rights', u'paris', u'crises', u'childrens fiction', u'ya fantasy', u'tween', u'teaching', u'wwii holocaust', u'legislators', u'geology', u'hilarious', u'eugenics', u'mythology fiction', u'health and nutrition', u'general science', u'running books', u'school', u'prize', u'non fiction memoir', u'school shooting', u'pulitzer prize', u'manga comics', u'essay collections', u'student teacher', u'samurai', u'chicago city', u'auto racing', u'1940s', u'fiction general', u'jamaica', u'mystery thriller', u'infernal devices', u'japanese', u'military sf', u'summer', u'puritans', u'friendships', u'colonialism', u'whaling', u'pacific northwest', u'cooking', u'asia', u'hard sf', u'literary criticism', u'warrior cats', u'books about hackers', u'new', u'books made into movies', u'pulitzer fiction', u'discrimination', u'leprosy', u'urbanfantasy', u'menage', u'chinese culture', u'civil war fiction', u'men', u'anthropology', u'lgbt', u'china', u'nanny', u'virgin heroine', u'spies', u'niagara falls', u'science nature', u'techno thriller', u'kids', u'childrens fiction', u'east asia', u'study', u'economics', u'newbery winners', u'necromancers', u'rock and roll', u'novellas short stories', u'youngadult', u'psychological thriller', u'military', u'dominican republic', u'intrigue', u'general nonfiction', u'criticism', u'norsk', u'spooky', u'printz', u'graceling', u'enduring friendships', u'psychological', u'awful people', u'alchemists', u'ai', u'cooking food', u'cerebral palsy', u'army', u'eastern europe', u'secret societies', u'indians', u'faerie', u'rwanda', u'music', u'investment', u'bdsm', u'rationalism', u'books that are movies', u'hollywood', u'sociopath', u'1961 1975', u'demon', u'economics business', u'prose poetry', u'grief', u'berlin', u'adventurers', u'love triangles', u'pulitzer', u'food related', u'southern writers', u'mm', u'work', u'movies', u'dysfunctional family', u'can lit', u'comedy drama', u'human trafficking', u'zimbabwe', u'foodie', u'werewolves shifters', u'programming', u'india', u'dublin murder squad', u'dragons', u'mermaids', u'murder mysteries', u'feminist book club', u'mothering', u'graphic novel comics', u'fiction horror', u'story', u'lds authors', u'cookery', u'palestine israel', u'aging', u'biographical', u'recovery', u'romantic suspense', u'end of the world', u'travel', u'autism spectrum', u'health and fitness', u'comedians', u'shifters', u'writers', u'aching', u'place', u'beach', u'self development', u'gaming', u'fever', u'british authors', u'lgbtq', u'cultural studies', u'creativity', u'president', u'law', u'lesbian', u'contemporary romance', u'ancient rome', u'john adams', u'summer reading', u'francophilia', u'social justice', u'cold blooded killers', u'capitalism', u'adventure travel', u'greek', u'sons', u'green', u'jungle', u'diary', u'atrocity', u'biographies', u'office', u'memoir biography', u'new adult dystopia', u'westerns', u'biopunk', u'romance paranormal', u'british country estate', u'japan', u'autobiography memoir', u'austria', u'adolescence', u'polygamy', u'writing', u'dprk', u'thought provoking', u'cree', u'iowa', u'diseases', u'microhistories', u'book to movie', u'colonial', u'literature fiction', u'american revolution', u'nobel', u'schools', u'singularity', u'crime mystery thriller', u'humanity', u'timetravel', u'netherlands', u'world war ii', u'bosnia', u'slavery', u'detroit', u'food health', u'fitness', u'european', u'heist', u'pop culture', u'paolo coelho', u'financial', u'pulitzer winner', u'juvenile fiction', u'crimes', u'nigerian', u'southern charm', u'trading', u'cathedral', u'ghosts', u'cat books', u'comedies', u'tudor court', u'god', u'tales', u'post colonial', u'spanish lit', u'forbidden love', u'millennium', u'medicine', u'history of science', u'arizona', u'roman empire', u'budapest', u'dracula', u'revenge', u'genghis khan', u'aboriginal', u'solitude', u'iraq war', u'lovesick maidens', u'picture books', u'dystopian future', u'cookbooks', u'equine', u'science and religion', u'renaissance', u'asian literature', u'refugee', u'secularism', u'suburbia', u'cell culture', u'indian lit', u'gender studies', u'1970s', u'hurricane katrina', u'child abduction', u'comix', u'naughty', u'norwegian literature', u'womens murder club', u'food nutrition', u'books on writing', u'fantasy', u'philosophical', u'leviathan', u'relations', u'african fiction', u'childrens literature', u'comic', u'overcoming adversity', u'non fic', u'alternative history', u'girls', u'fiction', u'tabitha suzuma', u'shiver', u'california', u'ww1', u'inferno', u'farming', u'dogs', u'urban', u'murder', u'collapse', u'dear john', u'gutsy women', u'real life', u'western', u'evil', u'mercy', u'gay lit', u'dystopian', u'fairytale', u'immigrants', u'ancient world', u'world war one', u'adult fiction', u'historical', u'powers', u'dark urban fantasy', u'fashion', u'conflict', u'ex police', u'boston', u'modern', u'mind', u'washington dc', u'health and medicine', u'australian books', u'suspense mystery', u'werewolves', u'newbery award', u'multiple pov', u'pacific crest trail', u'judaica', u'steam punk', u'comicbooks', u'fantasy high', u'memory', u'social issues', u'christian spiritual', u'history fiction', u'anatomy', u'germany', u'humor satire', u'bellwether prize', u'history biography', u'm f', u'chemistry', u'medical', u'made me cry', u'dog', u'civil war', u'tech', u'warming', u'nobel prize', u'marvel', u'literary horror', u'womens studies', u'saga', u'queen', u'teacher student', u'lit fic', u'north america', u'religions', u'queer', u'hungary', u'graphic novels comic books', u'badass hacker', u'sleuths', u'pomo', u'domestic servants', u'ya historical fiction', u'critical thinking', u'adult books', u'us history', u'lgbtqia', u'ya contemporary', u'rom com', u'presidential biographies', u'politics economics', u'mystery suspense thriller', u'new york city', u'historical novel', u'smut', u'novelists', u'post 9 11', u'japanese prison camp experiences', u'geek', u'literary non fiction books', u'haiti', u'love triangle', u'disaster', u'policial', u'south pacific', u'humanism', u'alternate universe', u'infertility', u'architecture', u'isolation', u'fertility', u'newspaper', u'magicians', u' television', u'reference', u'african history', u'memoir autobiography', u'highlander', u'1960s', u'6th grade', u'analytics', u'cloning', u'dark humor', u'disturbing', u'forensic science', u'utopia dystopia', u'oceania', u'food memoir', u'gulag', u'young adult romance', u'patients', u'artificial', u'vertigo', u'pets', u'1800s', u'a socials', u'book boyfriends', u'nature', u'spy books', u'multigenerational', u'teen reads', u'wtf', u'19th century', u'thriller suspense', u'the elite', u'climate', u'accident', u'social theory', u'ill', u'australian lit', u'us presidents', u'games', u'female protagonist', u'quests', u'midwifery', u'neoliberalism', u'books for children', u'american west', u'military science fiction', u'latinoamericana', u'epidemic', u'literary fiction', u'german lit', u'retelling', u'pregnancy', u'colonial history', u'psychology self help', u'mythological fiction', u'iraq', u'children ya', u'virtual reality', u'legend', u'ya lit', u'dc comics', u'cerebrovascular', u'life', u'families', u'economics and finance', u'drugs', u'books about food', u'science history', u'marijuana', u'children growing up through war', u'coffee table', u'mid east', u'chile', u'child', u'new zealand author', u'personal growth', u'postmodern', u'american history', u'tudor', u'the west', u'indian literature', u'thriller crime', u'weres', u'elves', u'race in america', u'cats', u'books to movies', u'books that made me cry', u'biotech', u'swoon worthy', u'mexico', u'food cookbooks', u'psychological thrillers', u'experience', u'seattle', u'family saga', u'arranged marriage', u'punctuation', u'newberry honor', u'babies', u'young adult books', u'ghost story', u'hugo award', u'young adult paranormal', u'brit lit', u'norwegian', u'autism aspergers', u'australian women writers', u'cooking and food', u'epistolary', u'american indian', u'vermont', u'love hate relationship', u'chechnya', u'gay fiction', u'academic', u'academia', u'burn victim', u'louisiana', u'turkish lit', u'alabama', u'seasonal', u'human rights', u'unemployment', u'graphic novels and manga', u'gods', u'ya horror', u'american literature', u'historicalfiction', u'international affairs', u'fighters', u'alexandria', u'psych', u'human', u'divorce', u'1776', u'interconnected short stories', u'siege of leningrad', u'childrens lit', u'assassination', u'character', u'alchemy', u'mother daughter relationships', u'collections', u'prison', u'anne boleyn', u'birth defects', u'religion and atheism', u'feel good', u'hypatia of alexandria', u'dystopian society', u'mindfuck', u'survival', u'arab', u'cultural criticism', u'cultural', u'barack obama', u'papua new guinea', u'birth', u'post apocalypse', u'unique', u'dreams', u'history nonfiction', u'down syndrome', u'performing', u'girl power', u'lace reading', u'zombies', u'motherhood', u'romance novels', u'abraham lincoln', u'people', u'sequential art', u'australian literature', u'post apocalyptic', u'memior', u'post modernism', u'kid lit', u'verse novel', u'image comics', u'wwi', u'social sciences', u'sociology', u'humor', u'theatre', u'maritime history', u'romans', u'espionage', u'vampire series', u'holiday', u'sci fi', u'energy', u'ww2', u'latin american literature', u'marketing', u'early america', u'faery', u'transhumanism', u'popular', u'childrens chapter books', u'cheating', u'authors of color', u'shortstories', u'marital', u'shadow falls', u'chicago worlds fair', u'high school', u'genocide', u'islands', u'food and nutrition', u'vietnam war', u'civil', u'prisoners', u'cannibalism', u'ancient egypt', u'wordplay', u'1990s', u'personal development', u'pulitzer finalist', u'best foreign book', u'postcolonial', u'strong women', u'new jersey', u'newbery medal winners', u'ya mystery', u'physicists', u'gods and goddesses', u'quirky', u'queens', u'war', u'man booker prize winner', u'postmodernism', u'form', u'tigers', u'newbery honors', u'sagas', u'best for bookclubs', u'black history', u'bengali', u'religious fiction', u'modern fiction', u'true', u'edelweiss', u'discipleship', u'homesteading', u'genealogy', u'alpha hero', u'tribal justice', u'fiction mystery', u'the host', u'plymouth', u'emotional', u'animal rights', u'horses', u'juvenile', u'spanish literature', u'classic', u'alt history', u'israel', u'indian writers', u'comics marvel', u'south africa', u'meteorology', u'quirky characters', u'social classes', u'male pov', u'nz', u'conditions', u'dystopian novels', u'17th century england', u'pulitzers', u'race relations', u'brothers', u'wanderlust', u'football', u'adult historical fiction', u'diet', u'journey', u'addictive', u'experimental fiction', u'legal thrillers', u'social studies', u'1775 1783', u'the sea', u'indian fiction', u'memiors', u'vietnam', u'time', u'australiana', u'canlit', u'1775 1800', u'downs syndrome', u'vampires', u'affair', u'global', u'detective fiction', u'counterculture', u'world history', u'growing up', u'suicide', u'nobel prize winner', u'on writing', u'monasteries', u'1945', u'environment', u'sports fiction', u'terror', u'american fiction', u'southern vampire mysteries', u'bioethics', u'billionaire', u'innovation', u'tearjerker', u'booker prize', u'fantasy and sci fi', u'ya historical', u'irish authors', u'urban fantasy', u'financial crisis', u'scandinavia', u'hawaii', u'awesome killer girls', u'love hate', u'natural history', u'aussie authors', u'zombie books', u'portuguese authors', u'spiritual', u'revolution', u'global health', u'fairytales', u'erotic', u'forensics', u'school shootings', u'caldecott medal', u'snipers', u'afghanistan', u'philosophy religion', u'church', u'rome', u'somalia', u'heroes of olympus', u'international', u'books on american history', u'political satire', u'african american fiction', u'parenthood', u'human behavior', u'adventure thriller', u'paranormal urban fantasy', u'french', u'witch', u'atheism and religion', u'father son relationship', u'mediums', u'canadian', u'lancaster', u'time travelling', u'widows', u'globalization', u'rock n roll', u'booker prize winner', u'ancient', u'weird', u'women writers', u'studies', u'nebula award', u'graphicnovels', u'humour', u'cold killers', u'shopaholic', u'south asia', u'necromancy', u'fictionalized memoir', u'roadtrip', u'erotica', u'womens fiction', u'kid books', u'france', u'reincarnation', u'12th century', u'the tudor court', u'nature science', u'peru', u'sf fantasy', u'black', u'australian', u'angels', u'father daughter relationships', u'x men', u'oregon', u'australian authors', u'paris france', u'revolutionary war', u'alternating pov', u'childrens lit', u'graphic', u'tokyo', u'20th century', u'video games', u'posthumous', u'cat', u'art fiction', u'foodies', u'afghan american', u'trans', u'military scifi', u'scandinavian crime', u'history american revolution', u'spy', u'9 11', u'uruguay', u'world literature', u'concierge', u'latin american lit', u'iranian revolution', u'south american', u'swedish', u'fantasy literature', u'winter', u'inheritance', u'afterlife', u'alzheimers', u'neuroscience', u'social psychology', u'public health', u'economy', u'edinburgh', u'historical crime', u'romance historical', u'southern', u'sustainability', u'heartbreaking', u'heroes', u'data', u'thriller horror', u'classroom', u'classics', u'new weird', u'ya novels', u'special needs', u'aussie author', u'cosmology', u'sk', u'capital punishment', u'african', u'sf', u'sword laser', u'cute', u'brain', u'colorado', u'native american literature', u'police', u'historical non fiction', u'united kingdom', u'food history', u'immortality', u'ya paranormal romance', u'werewolves shapeshifters', u'the zombie room', u'between the lines', u'policy', u'factual', u'norway', u'fiction contemporary', u'texas', u'fantasy juvenile', u'finance', u'indigenous', u'jewish fiction', u'australian author', u'fantasy humour', u'health and wellness', u'opera', u'cognition', u'graphic novels', u'history france', u'realistic', u'arts and crafts movement', u'idaho', u'comics and manga', u'sri lanka', u'fantasy magic', u'aspergers', u'realism', u'play', u'christian', u'latin', u'elephants', u'mystery thriller suspense', u'high fantasy', u'native american history', u'cyborgs', u'history world', u'disasters', u'pushing the limits', u'canada', u'living', u'witches wizards', u'music books', u'beauty', u'space', u'modern fantasy', u'fairy tale retelling', u'dutch', u'brazilian', u'travel writing', u'advice', u'professional development', u'french revolution', u'undead', u'theory', u'christmas stories', u'afghanistan war', u'guilty pleasure', u'adult contemporary', u'philosophy and religion', u'ohio', u'fantasy urban', u'explorers', u'anti religion', u'language', u'teachers', u'anti social', u'contemporary fantasy', u'punk', u'british', u'butterflies', u'futuristic', u'charleston', u'childhood', u'historical romance', u'intuition', u'americana', u'science fiction fantasy', u'paranormal romance', u'awesome killers', u'new adult romance', u'montreal', u'nobel laureate', u'americans', u'family history', u'spanish', u'genre fantasy', u'adult nonfiction', u'ghost stories', u'british lit', u'virgin', u'female author', u'women authors', u'tragic', u'death penalty', u'kick ass heroine', u'foot binding', u'non fiction history', u'presidential biography', u'ya paranormal', u'nutrition', u'child abuse', u'scandinavian literature', u'mysteries thrillers', u'cornwall', u'business finance', u'newberry', u'transgressive', u'bit lit', u'u s presidents', u'art history', u'television', u'sailing', u'general history', u'rehab', u'victorian', u'future', u'political economy', u'apples', u'paranormal fiction', u'yugoslavia', u'marines', u'climatology', u'russia', u'20s', u'illness', u'missing', u'angel', u'military history', u'greece', u'animal stories', u'prostitution', u'sad', u'conspiracy', u'suspense', u'romania', u'nazi', u'royals', u'warriors', u'biography history', u'fantasy series', u'european literature', u'sciences', u'fictitious', u'tear jerker', u'true story', u'action adventure', u'spec fic', u'children s book', u'arthurian', u'norwegian lit', u'saudi arabia', u'austen inspired', u'female authors', u'dog stories', u'murder mystery', u'superhero', u'america', u'death and dying', u'pulitzer finalists', u'booker prize winners', u'angst', u'farmers', u'archaeology', u'trafficking', u'professional', u'contemporary realistic fiction', u'detective', u'walking', u'nebula', u'german', u'serial killers', u'contemporary', u'blindness', u'portugueses', u'grit lit', u'maine', u'geography', u'dystopian apocalyptic', u'made into a movie', u'asian history', u'the passage', u'asperger syndrome', u'romanian', u'dystopia utopia', u'legal fiction', u'crime', u'spirituality', u'modern literary fiction', u'alcoholism', u'horse books', u'kickass heroine', u'secret society', u'mormon', u'science fiction and fantasy', u'biblical fiction', u'comic books graphic novels', u'historical fic', u'rhode island', u'latin america', u'japanese lit', u'afghan refugees', u'orphans', u'interpersonal', u'clowns', u'food books', u'london', u'ya romance', u'footbinding', u'siblings', u'ex military', u'national book award winners', u'comics and graphic novels', u'college', u'fitting in', u'sport', u'wonder', u'health nutrition', u'child narrator', u'family dysfunction', u'1600s', u'politics history', u'senate', u'genetic engineering', u'urban studies', u'sword and sorcery', u'teens', u'college life', u'jobs', u'uk', u'beach reads', u'abandoned children', u'depression era', u'human alien', u'nova scotia', u'life lessons', u'cities', u'war fiction', u'non fiction science', u'bio memoir', u'fictions', u'gothic fiction', u'city books', u'personal', u'fantasy romance', u'mongols', u'workplace', u'memoirs biographies', u'egyptian mythology', u'boarding school', u'pakistan', u'forecasting', u'war on terror', u'cancer', u'pow', u'asperger s syndrome', u'mongolia', u'learning', u'60s decade', u'poc', u'turkey', u'arts', u'alzheimer s disease', u'pop science', u'epistolary novels', u'drug addiction', u'west', u'short stories novellas', u'colombian literature', u'new orleans', u'mars', u'memoirs and biographies', u'vampires werewolves', u'sisterhood', u'contemporary fiction', u'health medicine', u'shopping', u'fantasy ya', u'spiritual growth', u'pulitzer prize fiction', u'regency', u'national book award', u'african childhood', u'forbidden romance', u'historical mysteries', u'spirit', u'captivity', u'african american studies', u'religion atheism', u'biography memoirs', u'thrillers', u'short fiction', u'novella', u'upstate new york', u' england ', u'crusades', u'lesbian fiction', u'high school romance', u'1919', u'second world war', u'nebula winner', u'india fiction', u'sudanese', u'savannah georgia', u'kenya', u'technology', u'super powers', u'intense', u'romance erotic', u'food', u'1900s', u'egyptian history', u'dog training', u'christmas books', u'abandoned', u'arctic', u'locus winners', u'running', u'writing craft', u'theater', u'romance contemporary', u'christian life', u'magical', u'fiction military', u'bounty hunter', u'grandfathers', u'scientists', u'age gap', u'parody', u'gangs', u'money', u'coming of age', u'canadian fiction', u'pulitzer prize for fiction', u'economics finance', u'brazilian rainforest', u'cliffhanger', u'visit to heaven', u'death', u'asthma', u'newbery medal', u'feminist', u'thinking', u'ugly cry', u'feminism', u'virginia', u'lgbt books', u'paranormal', u'dark', u'grammar', u'mystery crime', u'german history', u'assisted suicide', u'manhattan', u'shapeshifters', u'travelogue', u'robbers', u'southern writer', u'leningrad', u'witchcraft', u'glbt', u'dystopian books', u'roman mythology', u'glbtq', u'food wine', u'mental health', u'caribbean', u'dutch east india company', u'teen romance', u'memoirs biography', u'behavioral psychology', u'legal', u'ancient history', u'aussie', u'swedish literature', u'apocalyptic', u'fables', u'middle eastern', u'dark fantasy', u'leadership', u'historical biography', u'thailand', u'fairy', u'tudor fiction', u'chicklit', u'women s fiction', u'neo victorian', u'nordic noir', u'disabilities', u'animal behavior', u'muslims', u'assassin', u'bad boys', u'arabic', u'cambridge', u'communication', u'image', u'auschwitz', u'ancient mystery', u'united states', u'homeless', u'alpha males', u'elementary', u'pirates', u'art books', u'african american lit', u'racism', u'christianity', u'myths', u'animal human bond', u'brooklyn', u'artificial intelligence', u'alternate reality', u'european history', u'graphic novels comics', u'love story', u'lighthouses', u'british mysteries', u'christian fiction', u'serial killer', u'postapocalyptic', u'billionaires', u'clones', u'mice', u'nebula winners', u'south asian', u'male author', u'dominican', u'pulitzer non fiction', u'comics', u'summer reads', u'biographical fiction', u'fiction fantasy', u'zambia', u'beach read', u'locus sci fi', u'graphic novels and comics', u'general', u'mormons', u'journeys', u'britain', u'fairy tales', u'photography', u'planets', u'aids', u'supernatural paranormal', u'politics', u'metafiction', u'young adult fiction', u'yoga', u'irish lit', u'new age', u'narrativa', u'french history', u'books about writing', u'mathematics', u'pixies', u'junior fiction', u'demigods', u'conspiracies', u'diaries', u'social work', u'retellings', u'brotherhood', u'mormonism', u'south african literature', u'christian inspirational', u'alcohol', u'barcelona', u'social commentary', u'oriental', u'behavioral', u'taliban', u'essay', u'chinese', u'first nations', u'talking animals', u'religious', u'children', u'gritty fantasy', u'rights', u'catastrophe', u'diplomacy', u'1930s', u'antiherogirls', u'childhood memories', u'world war 1', u'brain candy', u'world war 2', u'midwest', u'man booker prize', u'russia ussr', u'egyptian', u'made into movie', u'17th century', u'horror', u'ya literature', u'british literature', u'us civil war', u'world war i', u'illustrated', u'heaven', u'columbine', u'dictatorship', u'mothers', u'greek mythology', u'spirituality religion', u'japanese authors', u'young detective', u'florida fiction', u'western romance', u'healthy eating', u'military war', u'tear jerkers', u'young adult', u'fast paced', u'politics current events', u'personal mba', u'religion and spirituality', u'wwii fiction', u'design', u'quebec', u'lawyer', u'fast food', u'chilean', u'irish literature', u'epic fantasy', u'investing', u'horror suspense', u'witnesses', u'self help', u'manga graphic novels', u'racing', u'us ambassador to germany', u'presidential bios', u'tattoos', u'iran', u'spiritual formation', u'hard science fiction', u'witchy', u'business books', u'italian fiction', u'annoying heroine', u'mystery historical', u'tragedy', u'british history', u'cultural germany', u'bible', u'diverse books', u'creepy', u'biographies memoirs', u'advertising', u'action', u'skepticism', u'heroic fantasy', u'family', u'adult romance', u'the south', u'africa', u'fantasy sci fi', u'editors', u'lgbt fiction', u'virgins', u'aesthetics', u'2000s', u'holocaust wwii', u'new zealand', u'florence', u'enemies to lovers', u'languages', u'pop psychology', u'hugo winner', u'alien invasion', u'children s books', u'moore christopher', u'attachment disorder', u'arthurian legend', u'teen', u'italian lit', u'police procedural', u'cold war', u'human animal relationships', u'space opera', u'cold scandinavia', u'young adult lit', u'microhistory', u'tudors', u'fanfiction', u'potatoes', u'creative nonfiction', u'town', u'christmas', u'science', u'scandinavian mysteries', u'paranormal mystery', u'faith based', u'history', u'beautiful', u'computers', u'memoirs', u'comic graphic novel', u'states', u'tom wolfe', u'fundamentalism', u'airplane', u'american south', u'biography', u'cyber punk', u'travel adventure', u'backpacking', u'technological', u'cultural revolution', u'maps', u'scifi', u'health wellness', u'unearthly', u'hopeless', u'sci fi and fantasy', u'sciencefiction', u'indian author', u'paranormal supernatural', u'mythpunk', u'children s literature', u'entrepreneurship', u'adventure', u'coming', u'productivity', u'ethics', u'awful killers', u'cults', u'short', u'hugo nominee', u'picturebooks', u'dragon', u'eating', u'sonoran desert', u'telephones', u'british mystery', u'nebula nominee', u'awful serial killers', u'dysfunctional families', u'north korea', u'surrealism', u'islam', u'childrensbooks', u'ethiopia', u'canadian authors', u'french resistance movement', u'environmentalism', u'wizards', u'movie tv', u'argentina', u'biographical novel', u'ya', u'black migration from the south', u'comic fantasy', u'judaism', u'mystery', u'how to', u'jfk assassination', u'book boyfriend', u'18th century', u'abused women', u'anti hero', u'friendship', u'popular science', u'investigators', u'england', u'mental', u'road trip', u'autobiographical', u'central asia', u'legal thriller', u'portland', u'nobel laureates', u'healthy living', u'fathers and daughters', u'cadavers', u'psychology', u'true adventure', u'nepal', u'war military', u'research', u'history books', u'health', u'asian fiction', u'popular fiction', u'wisconsin', u'nobel prize winners', u'1920s', u'reason', u'goblins', u'chick lit romance', u'feudal japan', u'revolutionary', u'cookbooks food', u'girly', u'fantastical', u'american', u'prejudice', u'apocalypse', u'historical nonfiction', u'botany', u'sword and laser', u'locus award', u'colombia', u'intellectualism', u'totalitarianism', u'horse', u'heads', u'fairy tale', u'paranormal vampires', u'art theory', u'seafaring', u'essays', u'molecular', u'eating disorders', u'graphic novel', u'1940s britain', u'young adult fantasy', u'autobiographies', u'everglades', u'nigeria', u'food politics', u'iranian', u'travel literature', u'scandinavian', u'youth', u'tudor history', u'marriage', u'superheroes', u'outdoors', u'books on books', u'procedural', u'motivation', u'north dakota', u'storytelling', u'english history', u'foster children', u'antarctica', u'japanese literature', u'family drama', u'18th century japan', u'16th century', u'dystopian post apocalyptic', u'speculative', u'forensic', u'scotland', u'tearjerkers', u'ya realistic fiction', u'14th century', u'college romance', u'heaven is for real', u'based on a true story', u'christian non fiction', u'australia nz', u'psychological mystery', u'fantasy scifi', u'alcoholic father', u'marie antoinette', u'foreign affairs', u'childhood favorites', u'dog books', u'banned', u'humanitarian', u'genre horror', u'physics', u'child soldiers', u'international relations', u'doctors', u'small town', u'mccarthyism', u'contemporary lit', u'canadian author', u'trolls', u'biography memoir', u'bad boy', u'alternate history', u'religion and philosophy', u'baseball books', u'dysfunctional', u'music related', u'rationality', u'scifi romance', u'acceptance', u'cholera', u'short story', u'shanghai', u'theft', u'southern gothic', u'mexican revolution', u'steampunk', u'millenium', u'ww ii', u'fantasy supernatural', u'nobel winners', u'abolitionist', u'psychological suspense', u'sf f', u'witches', u'restaurants', u'kids books', u'art', u'scandanavian crime', u'lgbtqa', u'sex', u'culture', u'individual', u'sports baseball', u'sea', u'beautiful writing', u'romance erotica', u'movie', u'demons', u'libraries', u'adult non fiction', u'corruption', u'celebrity', u'europe', u'korea', u'mayflower', u'art theft', u'salman rushdie', u'ya sci fi', u'voyages', u'jane austen related', u'fun reads', u'tough issues', u'history russia', u'canadiana', u'secrets', u'lost generation', u'foreign', u'benjamin franklin', u'graphic novels manga', u'short story collection', u'ya dystopia', u'experimental', u'scandinavian lit', u'prose', u'identity theft', u'czech republic', u'british contemporary fiction', u'action thriller', u'medical history', u'philadelphia', u'tennessee', u'scottish', u'short stories and essays', u'dystopic', u'children books', u'abolition', u'history anthropology', u'devil', u'romantic comedy', u'political', u'strategy', u'ireland', u'tudor era', u'suspense thriller', u'weird fiction', u'cultural india', u'flight', u'1950s', u'gay', u'black dagger', u'scifi fantasy', u'history non fiction', u'mystery thrillers', u'mystery thriller horror', u'food and wine', u'comic books', u'plants', u'laugh out loud', u'u s history', u'adult fantasy', u'holocaust', u'black humor', u'sexuality', u'behavior', u'post traumatic stress', u'school violence', u'older woman younger man', u'portugal', u'century', u'award winner', u'imperialism', u'women s issues', u'historical thriller', u'flying machines', u'funny', u'lbj', u'italy', u'comics graphic novels', u'short stories essays', u'maids', u'drug abuse', u'chinese literature', u'expeditions', u'forgiveness', u'daughters', u'development', u'lawyers', u'wall street', u'fairies', u'war stories', u'global warming', u'holidays', u'fairy tales retold', u'poli sci', u'american civil war', u'graphicnovel', u'international development', u'werewolf', u'poland', u'horse racing', u'theology', u'jazz age', u'historic', u'nordic', u'inspirational', u'calcutta', u'dystopias', u'teen fiction', u'ambassador', u'19th century fairy tales', u'national book award winner', u'lds', u'mystery suspense', u'world', u'history of medicine', u'anthologies', u'hiking', u'21st century fiction', u'americas', u'the tudors', u'ww 2', u'presidents', u'crime spree', u'slave', u'guilty pleasures', u'food and cooking', u'non fiction literature', u'bio', u'australia', u'victims', u'ozarks', u'loss', u'organ donation', u'self improvement', u'asperger s', u'lincoln', u'pilgrimage', u'swimming', u'asian american', u'sixties', u'horror fiction', u'teen fantasy', u'the twilight saga', u'mutants', u'humorous fiction', u'mary magdalene', u'southern literature', u'multicultural', u'crime thriller', u'historical mystery', u'fantasy science fiction', u'ptsd', u'ecology', u'gardening', u'humorous', u'fathers', u'friends to lovers', u'economic', u'newbery winner', u'san francisco', u'shipwrecks', u'soviet union', u'flying', u'appalachia', u'crisis', u'religion', u'civilization', u'psychology sociology', u'epic', u'current events', u'palestinian literature', u'princesses', u'great depression', u'foster care', u'zombie', u'ya series', u'taboo', u'non fiction religion', u'historic fiction', u'faith', u'dystopia', u'edwardian england', u'hemingway', u'books on engineering', u'virus', u'drama', u'sea stories', u'miracles', u'paralysis', u'aliens', u'botanical interest', u'world lit', u'green living', u'sports', u'jews', u'statistics', u'chicago worlds fair', u'disability', u'teen books', u'thriller', u'time traveling', u'food drink', u'exercise', u'history american', u'dystopian romance', u'jewish', u'motivational', u'immigration', u'boys', u'fairytale retelling', u'segregation', u'historical fiction', u'russian', u'man booker winners', u'victoriana', u'comic book', u'young adults', u'quick reads', u'cozy mysteries', u'exploration', u'fiction historical', u'ussr', u'south carolina', u'sea voyage', u'pregnancy birth', u'tahiti', u'chilean literature', u'nautical', u'mother daughter', u'south african', u'italian literature', u'biblical', u'anthology', u'magical realisim', u'endurance', u'new zealand authors', u'subways', u'british isles', u'food memoirs', u'writing books', u'american lit', u'vampire romance', u'spanish authors', u'genetics', u'desert', u'native american', u'fighter', u'nebula award winners', u'officers', u'age', u'children s chapter books', u'historical novels', u'religious studies', u'canadian lit', u'biographies and memoirs', u'amish', u'kick ass heroines', u'magical realism', u'modern classics', u'alien', u'history russian', u'midnight sun', u'early american history', u'behavioral economics', u'fiction romance', u'detectives', u'baseball', u'african american history', u'turkish', u'caldecott', u'literary', u'culinary', u'austenesque', u'hipster', u'pharmaceutical research', u'hugo award winners', u'garden', u'torture', u'abduction', u'sports books', u'hugo nominees', u'magic', u'gender', u'memoir bio', u'page turner', u'race', u'history politics', u'massachusetts', u'childhood reads', u'religion spirituality', u'angel island', u'blitz', u'edwardian', u'golems', u'george washington', u'odd', u'depression', u'history wwii', u'nevada', u'plays', u'business', u'bibliophiles', u'chicago', u'vampire', u'super hero', u'19th', u'indian', u'twins', u'witch song', u'modern lit', u'values', u'salem', u'childrens books', u'nazis', u'body', u'american politics', u'cozy', u'orleans', u'pulitzer prize winners', u'mystery detective', u'poverty', u'healing', u'sexy', u'contemporary ya', u'ukraine', u'rhodesia', u'faeries', u'short story collections', u'cleopatra', u'alaska', u'justice', u'graphic_novel', u'bookstores', u'music biography', u'non fiction sports', u'new adult', u'freemasons', u'egypt', u'bible study', u'dwarves', u'health fitness', u'american midwest', u'private', u'minnesota', u'the wedding', u'nantucket', u'wit', u'religion philosophy', u'near death experience', u'imaginary', u'historical fiction egypt', u'country noir', u'children young adult', u'usa', u'political history', u'cozy mystery', u'indigenous lit', u'award winning', u'last survivors', u'action packed', u'amazing first work by author', u'fey', u'shipwreck', u'chick books', u'econ', u'mystery crime thriller', u'political theory', u'emigration', u'comics manga', u'indian writing', u'hard sci fi', u'baby', u'gentleman bastard', u'books into movies', u'women', u'1980s', u'animals', u'bible studies', u'quarter life crisis', u'napoleonic', u'archer', u'servants', u'island', u'angsty', u'pedagogy', u'potus', u'new england', u'body image', u'violence', u'marvel comics', u'halloween', u'teen lit', u'founding fathers', u'german occupation', u'cognitive science', u'supernatural fiction', u'historical_fiction', u'hot for teacher', u'serial', u'rape', u'native', u'autobiography', u'educational', u'united', u'best on afghanistan', u'native american lit', u'racial discrimination', u'regions', u'animal', u'jane austen', u'mysteries', u'comedy', u'memoir', u'posthuman', u'military fiction', u'brothers and sisters', u'non fiction humor', u'farm', u'philosophy', u'collection', u'aborigines', u'abuse', u'ethnic', u'family relationships', u'spelling', u'christian reads', u'gargoyles', u'bombers', u'books in verse', u'finance economics', u'wwii', u'super heroes', u'pulitzer winners', u'social science', u'mute', u'crime thrillers', u'geopolitics', u'southern lit', u'israel palestine', u'time travel romance', u'symbols', u'french lit', u'christian books', u'man booker prize winners', u'ya graphic novels', u'turkish literature', u'changeling', u'linguistics', u'gunslinger', u'rock', u'food lit', u'lithuania', u'labor', u'thieves', u'printz award', u'alpha male', u'seabiscuit', u'child prostitution', u'sci fi fantasy', u'true life novel', u'heart transplant', u'courtroom', u'nyc', u'historical fantasy', u'nf history', u'kindness', u'hippies', u'presidential', u'liberia', u'university', u'contemporary literature', u'alexander hamilton', u'vampire books', u'chapter book', u'gender bender', u'history and biography', u'time travel', u'popculture', u'fairytale retellings', u'man booker winner', u'father daughter relationship', u'serbia', u'dante', u'society', u'scandinavian mystery', u'books', u'paranormal fantasy', u'teenlit', u'agriculture', u'books about books', u'gold rush', u'entertainment', u'activism', u'friends relationships', u'communes', u'booker winner', u'conqueror', u'arkansas', u'crime fiction', u'math', u'fairy tale retellings', u'irish fiction', u'eco', u'asian lit', u'english literature', u'interplanetary', u'wizard', u'tortured hero', u'young adult literature', u'foreign policy', u'reporters', u'indian mythology', u'princess', u'paranormal ya', u'scary', u'islamic', u'florida', u'homelessness', u'christian lit', u'south', u'indie', u'political science', u'science and medicine', u'jesus', u'dystopian fiction', u'congo', u'steamy', u'hitler s rise to power', u'african authors', u'decision making', u'hugo winners', u'management', u'cormoran strike', u'history historical fiction', u'steamy romance', u'north carolina', u'alzheimer s', u'new york', u'athletics', u'palestine', u'pakistani', u'african americans', u'superheros', u'science medicine', u'shorts', u'baseball as a metaphor for life', u'environmental', u'natural', u'myths legends', u'domestic abuse', u'warfare', u'speculative fiction', u'highlanders', u'food industry', u'dual timeline', u'science fiction', u'sweden', u'crime mystery', u'graphic novel comic', u'fantasy fiction', u'nonfiction', u'social history', u'dementia', u'wolves', u'indian authors', u'salem witch trials', u'korean', u'latino', u'portuguese literature', u'brazil', u'tudor england', u'healthcare', u'third reich', u'unreliable narrator', u'parenting', u'historical fiction ancient', u'middle east', u'sff', u'addiction', u'small town life', u'stranded', u'disease', u'manga', u'absurd', u'los angeles', u'werewolfs', u'short stories', u'ancient greece', u'ya books', u'soldiers', u'anti semitism', u'novels in verse', u'inspiring', u'communism', u'noir', u'fantasy epic', u'christian nonfiction', u'badass heroine', u'age difference', u'military sci fi', u'the others', u'childrens picture books', u'pirate', u'pregnancy childbirth', u'religous', u'chick lit', u'cuba', u'michigan', u'far east', u'maritime', u'controversial topic', u'african american', u'travel books', u'romantic', u'made into movies', u'evolution', u'medical thriller', u'jewish literature', u'home library', u'colonial america', u'current affairs', u'monsters', u'true crime', u'wormholes', u'african american literature', u'motorcycle', u'warrior', u'climate change', u'national', u'modern non fiction', u'immigrant', u'computer', u'biography autobiography', u'pennsylvania', u'cyberpunk', u'canadian literature', u'bosnia herzagovina', u'love stories', u'newbery books', u'german literature', u'supernatural', u'injustice', u'language linguistics', u'colombian', u'transhuman', u'foodie books', u'australian fiction', u'realistic fiction', u'u s  history', u'pen faulkner award', u'awful facts', u'czechoslovakia', u'pilgrims', u'career', u'sibling rivalry', u'antisocial', u'immigrant experience', u'plantation life', u'mental illness', u'vampire fiction', u'crime and mystery', u'norwegian authors', u'jersey', u'fantasy paranormal', u'near future', u'picture book', u'japanese fiction', u'data science', u'locavore', u'fairy tale inspired', u'nostalgia', u'nonfiction history', u'incest', u'latin american', u'women s health', u'asphyxia', u'catholicism', u'hunters', u'socialism', u'nazi french occupation', u'kitchen', u'diversity', u'animal fantasy', u'novellas', u'russian history', u'orange', u'dual pov', u'animal fiction', u'graphics', u'spain', u'music biographies', u'genghis', u'health care', u'ya dystopian', u'fiction literature', u'm m romance', u'medieval fantasy', u'mythology', u'fantasy humor', u'poc author', u'memoirs bios', u'gothic', u'adultery', u'writers of color', u'black studies', u'general non fiction', u'light reading', u'angel books', u'biography and memoir', u'poetry', u'about wwi', u'medieval england', u'romance', u'buddhism', u'strange', u'film', u'novel in verse', u'changelings', u'terrorism', u'gender and sexuality', u'kidnapping', u'scottish fiction', u'reporting', u'anthropomorphism', u'fathers and sons', u'bullying', u'magic realism', u'novela', u'sisters', u'inspirational fiction', u'identity', u'dystopia post apocalyptic', u'non fiction general', u'food cooking', u'atheism religion', u'indonesia', u'womens studies', u'british fiction', u'awesome hackers', u'soviet', u'girly books', u' psychology ', u'psychological horror', u'necromancer', u'monarch butterflies', u'indentured servants', u'moral dilemmas', u'antisemitism', u'around the world', u'surreal', u'african lit', u'sudan', u'pulitzer prize winner', u'courtroom drama', u'adoption', u'prize winners', u'occult', u'bios memoirs', u'myth', u'government', u'biologists', u'asian culture', u'utah', u'anthropologists', u'historia', u'royalty', u'adolf hitler', u'bildungsroman', u'nanotechnology', u'transgressive fiction', u'thrill', u'adult paranormal', u'journalism', u'military fantasy', u'sarajevo', u'indian books', u'refugees', u'banned books', u'italian', u'native americans', u'spy thriller', u'nazi germany', u'immortal', u'cultural identity', u'american presidents', u'queer lit', u'erotic romance', u'southern fiction', u'world war two', u'quilting', u'narrative nonfiction', u'auto biography', u'asian fantasy', u'hurricane', u'hard boiled', u'south america', u'passion', u'mutation', u'allegory', u'horticulture', u'biology', u'medical research', u'medieval', u'food and drink', u'dreams come true', u'syrian', u'african literature', u'lighthouse', u'ya fiction', u'epidemiology', u'japanese internment', u'balkans', u'booker winners', u'cultural history', u'devotionals', u'consumerism', u'lifestyle', u'middle aged', u'channel islands', u'futurism', u'mythological', u'middle ages', u'childrens', u'wilderness', u'unwind', u'satire', u'washington', u'gastronomy', u'artists', u'austen', u'chapter books', u'hugo nebula', u'bombay', u'mississippi', u'chinese american', u'cinderella', u'bees', u'history us', u'amnesia', u'food culture', u'devotional', u'assassins', u'plague', u'horror thriller', u'caldecott winners', u'witches and wizards', u'barefoot running', u'editing', u'pregnancy parenting', u'meta', u'stories', u'infants', u'nasa', u'informational', u'irish', u'rabbits', u'true stories', u'circus', u'auto biographies', u'mothers and daughters', u'superpowers', u'business economics', u'education', u'black authors', u'autism', u'newbery honor', u'concentration camps', u'trials', u'illinois', u'post modern', u'default', u'adolescent literature', u'twist endings', u'autobiography biography', u'civil rights', u'missouri', u'graphic_novels', u'thriller mystery', u'bereavement', u'biotechnology', u'food writing', u'astronomy', u'friends', u'inspiration', u'ghost', u'henry viii', u'accidents', u'mythopoeic', u'atheist', u'hungarian jews', u'atheism', u'rural', u'cookbook', u'hardboiled']
    for i, rel_shelf in enumerate(relevant_shelves):
        relevant_shelves[i] = unicode(rel_shelf).replace(' ', '-')
    new_shelf_dicts = []
    for item in shelf_dicts:
        workingdict = {}
        for key, value in item.iteritems():
            if key in relevant_shelves:
                if 'book_id' not in workingdict:
                    workingdict['book_id'] = item['book_id']
                workingdict[key] = value
        new_shelf_dicts.append(workingdict)

    keywords = relevant_shelves

    # make corpus of review bodies by book_id
    corpus = []
    for database_item in database:
        checker = False
        for corpus_item in corpus:
            if database_item[0] == corpus_item['book_id']:
                corpus_item['body'] = corpus_item['body'] + ' . ' + database_item[1]
                checker = True
        if checker is False:
            corpus.append({'book_id': database_item[0], 'body': database_item[1], 'rating': database_item[2]})

    scores = []
    for book in corpus:
        for keyword in keywords:
            tempdict = {}
            tempdict['book_id'] = book['book_id']
            tempdict['category'] = keyword
            if keyword in book['body']:
                tempdict['score'] = get_sentiment_by_keyword(book['body'], keyword)
                if tempdict['score'] > 0:
                    scores.append(tempdict)

    conn.close()

    # get list of all shelf names for CSV headers
    headers = ['book_id', 'category', 'score']

    # export to CSV
    outfile = "scores.csv"
    with open(outfile, 'wb') as target:
        writer = csv.DictWriter(target, fieldnames=headers)
        writer.writeheader()
        for row in scores:
            writer.writerow(row)
